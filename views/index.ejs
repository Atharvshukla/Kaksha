<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveTrace</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" integrity="sha512-h9FcoyWjHcOcmEVkxOfTLnmZFWIH0iZhZT1H2TbOq55xssQGEJHEaIm+PgoUaZbRvQTNTluNOEfb1ZRy6D3BOw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Dark theme with interactive effects */
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: Arial, sans-serif;
        }

        nav {
            background-color: #1f1f1f;
            padding: 1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #4CAF50;
        }

        nav h1 {
            margin: 0;
            color: #4CAF50;
        }

        nav ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            display: flex;
            gap: 1em;
        }

        nav li {
            margin: 0;
        }

        nav a {
            color: #ffffff;
            text-decoration: none;
            font-size: 1.2em;
            padding: 0.5em 1em;
            border-radius: 5px;
            transition: background-color 0.3s, color 0.3s, transform 0.3s;
        }

        nav a:hover {
            background-color: #45a049; 
            transform: scale(1.05);
        }

        #map {
            height: 500px;
            width: 100%;
            border: 2px solid #4CAF50;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            margin-top: 1em;
        }

        .form-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.7); 
            z-index: 1000; 
        }

        .form-container {
            background-color: #1f1f1f;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            width: 50%;
            max-width: 600px;
            text-align: center;
            color: #ffffff;
            position: relative;
        }

        .form-section {
            margin-bottom: 1em;
        }

        .form-close {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 1.2em;
            color: #888;
            transition: color 0.3s;
        }

        .form-close:hover {
            color: #ffffff;
        }

        .form-container input, .form-container button {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #4CAF50;
            background-color: #2e2e2e;
            color: #ffffff;
            transition: background-color 0.3s, border 0.3s, transform 0.3s;
        }

        .form-container input:focus, .form-container button:hover {
            background-color: #3f3f3f;
            border: 1px solid #45a049;
            transform: scale(1.05);
        }

        .form-container button {
            cursor: pointer;
            background-color: #4CAF50;
            color: #ffffff;
        }

        #geofence-alert, #status {
            color: #4CAF50;
            margin: 1em 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <nav>
        <h1>LiveTrace</h1>
        <ul>
            <li><a href="#" id="set-marker-link">Set Marker</a></li>
            <li><a href="#" id="set-geofence-link">Set Geofence</a></li>
            <li><a href="#" id="send-message-link">Chat</a></li>
            <li><a href="#" id="report-incident-link">Report Incident</a></li>
            <li><a href="#" id="view-incidents-link">View Incidents</a></li>
            <li><a href="#" id="allocate-resources-link">Allocate Resources</a></li>
        </ul>
    </nav>

    <!-- Marker form overlay -->
    <div class="form-overlay" id="markerFormOverlay">
        <div class="form-container">
            <span class="form-close" id="closeMarkerForm">&times;</span>
            <form id="markerForm" class="form-section">
                <input type="number" id="lat" placeholder="Latitude" step="any" required>
                <input type="number" id="lng" placeholder="Longitude" step="any" required>
                <button type="submit" id="set-marker">Set Marker</button>
            </form>
        </div>
    </div>

    <!-- Geofence form overlay -->
    <div class="form-overlay" id="geofenceFormOverlay">
        <div class="form-container">
            <span class="form-close" id="closeGeofenceForm">&times;</span>
            <form id="geofenceForm" class="form-section">
                <input type="number" id="geofence-lat" placeholder="Geofence Latitude" step="any" required>
                <input type="number" id="geofence-lng" placeholder="Geofence Longitude" step="any" required>
                <input type="number" id="geofence-radius" placeholder="Geofence Radius (meters)" step="any" required>
                <button type="submit" id="set-geofence">Set Geofence</button>
            </form>
        </div>
    </div>

    <!-- Message form overlay -->
    <div class="form-overlay" id="messageFormOverlay">
        <div class="form-container">
            <span class="form-close" id="closeMessageForm">&times;</span>
            <form id="messageForm" class="form-section">
                <input type="text" id="message" placeholder="Enter a message">
                <input type="text" id="message" placeholder="Enter a message">
                <button id="send-message">Send Message</button>
                <div id="messages"></div>
            </form>
        </div>
    </div>

    <!-- Incident form overlay -->
    <div class="form-overlay" id="incidentFormOverlay">
        <div class="form-container">
            <span class="form-close" id="closeIncidentForm">&times;</span>
            <form id="incidentForm" class="form-section">
                <input type="number" id="incident-lat" placeholder="Incident Latitude" step="any" required>
                <input type="number" id="incident-lng" placeholder="Incident Longitude" step="any" required>
                <input type="text" id="incident-description" placeholder="Incident Description" required>
                <button type="submit" id="report-incident">Report Incident</button>
            </form>
        </div>
    </div>

    <!-- Incident list overlay -->
    <div class="form-overlay" id="incidentListOverlay">
        <div class="form-container">
            <span class="form-close" id="closeIncidentList">&times;</span>
            <h2>Reported Incidents</h2>
            <div id="incident-list"></div>
        </div>
    </div>

    <!-- Resource allocation overlay -->
    <div class="form-overlay" id="resourceAllocationOverlay">
        <div class="form-container">
            <span class="form-close" id="closeResourceAllocation">&times;</span>
            <form id="resourceAllocationForm" class="form-section">
                <input type="text" id="resource-type" placeholder="Resource Type" required>
                <input type="number" id="resource-quantity" placeholder="Resource Quantity" required>
                <input type="number" id="resource-lat" placeholder="Latitude" step="any" required>
                <input type="number" id="resource-lng" placeholder="Longitude" step="any" required>
                <button type="submit">Allocate Resources</button>
            </form>
        </div>
    </div>

    <input type="text" id="username" placeholder="Enter your name">
    <div id="status"></div>
    <div id="map"></div>
    <div id="geofence-alert"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js" integrity="sha512-puJW3E/qXDqYp9IfhAI54BJEaWIfloJ7JWs7OeD5i6ruC9JZL1gERT1wjtwXFlh7CjE7ZJ+/vcRZRkIYIb6p4g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" integrity="sha384-2huaZvOR9iDzHqslqwpR87isEmrfxqyWOF7hr7BY6KG0+hVKLoEXMPUJw3ynWuhO" crossorigin="anonymous"></script>
    <script src="/js/script.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const markerFormOverlay = document.getElementById('markerFormOverlay');
            const geofenceFormOverlay = document.getElementById('geofenceFormOverlay');
            const messageFormOverlay = document.getElementById('messageFormOverlay');
            const incidentFormOverlay = document.getElementById('incidentFormOverlay');
            const incidentListOverlay = document.getElementById('incidentListOverlay');
            const resourceAllocationOverlay = document.getElementById('resourceAllocationOverlay');

            const closeMarkerForm = document.getElementById('closeMarkerForm');
            const closeGeofenceForm = document.getElementById('closeGeofenceForm');
            const closeMessageForm = document.getElementById('closeMessageForm');
            const closeIncidentForm = document.getElementById('closeIncidentForm');
            const closeIncidentList = document.getElementById('closeIncidentList');
            const closeResourceAllocation = document.getElementById('closeResourceAllocation');

            const setMarkerLink = document.getElementById('set-marker-link');
            const setGeofenceLink = document.getElementById('set-geofence-link');
            const sendMessageLink = document.getElementById('send-message-link');
            const reportIncidentLink = document.getElementById('report-incident-link');
            const viewIncidentsLink = document.getElementById('view-incidents-link');
            const allocateResourcesLink = document.getElementById('allocate-resources-link');

            const markerForm = document.getElementById('markerForm');
            const geofenceForm = document.getElementById('geofenceForm');
            const messageForm = document.getElementById('messageForm');
            const incidentForm = document.getElementById('incidentForm');
            const resourceAllocationForm = document.getElementById('resourceAllocationForm');

            setMarkerLink.addEventListener('click', function(event) {
                event.preventDefault();
                markerFormOverlay.style.display = 'flex';
            });

            setGeofenceLink.addEventListener('click', function(event) {
                event.preventDefault();
                geofenceFormOverlay.style.display = 'flex';
            });

            sendMessageLink.addEventListener('click', function(event) {
                event.preventDefault();
                messageFormOverlay.style.display = 'flex';
            });

            reportIncidentLink.addEventListener('click', function(event) {
                event.preventDefault();
                incidentFormOverlay.style.display = 'flex';
            });

            viewIncidentsLink.addEventListener('click', function(event) {
                event.preventDefault();
                incidentListOverlay.style.display = 'flex';
                displayReportedIncidents(); 
            });

            allocateResourcesLink.addEventListener('click', function(event) {
                event.preventDefault();
                resourceAllocationOverlay.style.display = 'flex';
            });

            closeMarkerForm.addEventListener('click', function() {
                markerFormOverlay.style.display = 'none';
            });

            closeGeofenceForm.addEventListener('click', function() {
                geofenceFormOverlay.style.display = 'none';
            });

            closeMessageForm.addEventListener('click', function() {
                messageFormOverlay.style.display = 'none';
            });

            closeIncidentForm.addEventListener('click', function() {
                incidentFormOverlay.style.display = 'none';
            });

            closeIncidentList.addEventListener('click', function() {
                incidentListOverlay.style.display = 'none';
            });

            closeResourceAllocation.addEventListener('click', function() {
                resourceAllocationOverlay.style.display = 'none';
            });

            markerForm.addEventListener('submit', function(event) {
                event.preventDefault();
                // Add marker logic
                markerFormOverlay.style.display = 'none';
            });

            geofenceForm.addEventListener('submit', function(event) {
                event.preventDefault();
                // Add geofence logic
                geofenceFormOverlay.style.display = 'none';
            });

            messageForm.addEventListener('submit', function(event) {
                event.preventDefault();
                // Send message logic
                messageFormOverlay.style.display = 'none';
            });

            incidentForm.addEventListener('submit', function(event) {
                event.preventDefault();
                reportIncident();
                incidentFormOverlay.style.display = 'none';
            });

            resourceAllocationForm.addEventListener('submit', function(event) {
                event.preventDefault();
                // Allocate resources logic
                resourceAllocationOverlay.style.display = 'none';
            });

            function reportIncident() {
                const lat = document.getElementById('incident-lat').value;
                const lng = document.getElementById('incident-lng').value;
                const description = document.getElementById('incident-description').value;
                const socket = io();
                socket.emit('reportIncident', { lat, lng, description });
            }

            function displayReportedIncidents() {
                const incidentList = document.getElementById('incident-list');
                incidentList.innerHTML = ''; 
                const socket = io();
                socket.emit('getReportedIncidents');
                socket.on('reportedIncidents', function(incidents) {
                    incidents.forEach(function(incident) {
                        const listItem = document.createElement('div');
                        listItem.textContent = `Location: (${incident.lat}, ${incident.lng}), Description: ${incident.description}`;
                        incidentList.appendChild(listItem);
                    });
                });
            }
        });
    </script>
</body>
</html>
